<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire de nouvelle</title>

    <script src="js/main.js" defer></script>
    <script src="js/infiniteScrolling.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
</head>
<body>
    <div class="container" style="margin: auto; display: flex; flex-direction: column;">
        <div class="row">
            <div class="col">

                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#createNouvelleModal">
                    Ajouter une nouvelle
                </button>
            </div>

            <div>
                <div id="createNouvelleModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false"
                    tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header">
                                <h5 class="modal-title">Créer une nouvelle</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>

                            <div class="modal-body">
                                <form id="createNouvelle">
                                    <input id="createNouvelle_Id" type="number" hidden value=0>

                                    <div class="input-group mb-3">
                                        <input required placeholder="Titre" class="form-control"
                                            id="createNouvelle_Title" type="text">
                                    </div>

                                    <div class="input-group mb-3">
                                        <span class="input-group-text noselect"
                                            id="createNouvelle_preUrl">https://</span>
                                        <input required placeholder="Url de l'image" class="form-control"
                                            id="createNouvelle_Url" type="text"
                                            aria-describedby="createNouvelle_preUrl">
                                    </div>

                                    <div class="input-group mb-3">
                                        <input required placeholder="Categorie" class="form-control"
                                            id="createNouvelle_Categorie" type="text">
                                    </div>

                                    <div class="input-group mb-3">
                                        <textarea id="createNouvelle_Texte" required
                                            placeholder="Description de la nouvelle" class="form-control"></textarea>
                                    </div>

                                    <div class="input-group mb-3">
                                        <input required class="form-control" id="createNouvelle_Date" type="date">
                                    </div>

                                    <button id="createNouvelle_submit" type="submit"
                                        class="btn btn-primary">Créer</button>
                                    <button id="createNouvelle_cancel" type="button" class="btn btn-outline-danger"
                                        data-bs-dismiss="modal" aria-label="Close">Annuler</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- <div class="mainContainer"> -->
            <!-- <div class="scrollContainer"> -->
        <div class="row">
            <div>
                <div class="Header">
                    Liste de nouvelles
                </div>
                <div class="newsList row row-cols-1 row-cols-md-2 g-4">
                    <!--- Filled programmatically -->
                </div>
            </div>
        </div>
    </div>
    

    <script defer>
        // const Host = "http://localhost:5000";
        // const API = "/api/news";
        // const periodicRefreshPeriod = 5;
        // let currentETag = "";

        // webAPI_HEAD(checkETag);
        // setInterval(() => {
        //     webAPI_HEAD(checkETag);
        // }, periodicRefreshPeriod * 1000);

        // function checkETag(ETag) {
        //     if (ETag != currentETag) {
        //         currentETag = ETag;
        //         webAPI_GET_ALL(fillDataList, "");
        //     }
        // }
        // function webAPI_GET_ALL(successCallBack, queryString = "") {
        //     $.ajax({
        //         url: Host + API + queryString,
        //         type: 'GET',
        //         contentType: 'text/plain',
        //         data: {},
        //         success: (data, status, xhr) => {
        //             let ETag = xhr.getResponseHeader("ETag");
        //             successCallBack(data, ETag);
        //             console.log("webAPI_GET_ALL - success", data);
        //             console.log(`ETag: ${ETag}`);
        //         },
        //         error: function (jqXHR) {
        //             errorCallBack(jqXHR.status);
        //             console.log("webAPI_HEAD - error", jqXHR.status);
        //         }
        //     });
        // }
        // function webAPI_HEAD(successCallBack) {
        //     $.ajax({
        //         url: Host + API,
        //         type: 'HEAD',
        //         contentType: 'text/plain',
        //         complete: function (request) {
        //             console.log(request.getResponseHeader('ETag'));
        //             successCallBack(request.getResponseHeader('ETag'));
        //         },
        //         error: function (jqXHR) {
        //             console.log("webAPI_HEAD - error", jqXHR.status);
        //         }
        //     });
        // }

        // const New = (data) => `
        // <div class="col">
        //     <div class="card border-dark">
        //         <img src="${ data.ImageUrl == undefined ? data.Url : data.ImageUrl}">
        //         <div class="card-body">
        //             <h5 class="card-title">${data.Titre}</h5>
        //             <p class="card-text">${ data.Texte.length >= 750 ? data.Texte.substring(0, 500) + "..." : data.Texte }</p>
        //         </div>
        //         <div class="card-footer">
        //             <small>${ new Date(parseInt(data.Date)).toISOString().split("T")[0] }</small>
        //         </div>
        //     </div>
        // </div>
        // `;
        
        // function insertDataRow(dataRow){

        //     console.debug(dataRow);
        //     $(".newsList").append(New(dataRow));

        //     // insertStartDiv("newsData")
        //     // insertDataCell("title", dataRow.Titre);
        //     // insertDataCell("date", dataRow.Date);
        //     // insertDataCell("categorie", dataRow.Categorie);
        //     // insertImageCell(dataRow.ImageUrl);
        //     // insertDataCell("texte", dataRow.Texte);
        //     // insertEndDiv();
        // }

        // function insertStartDiv(className, id = ""){
        //     $(".newsList").append(`<br><br><div class="${className}">`);
        // }

        // function insertEndDiv(){
        //     $(".newsList").append(`</div>`);
        // } 

        // function insertDataCell(className, data) {
        //     $(".newsList").append($(`<div class="${className}"><div class='text'> + ${data} + </div></div>"`));
        // }

        // function insertImageCell(data) {
        //     $(".newsList").append($("<div class='image'><img src='" + data + "'></div>"));
        // }

        // function fillDataList(dataList, ETag) {
        //     currentETag = ETag;
        //     let currentCat = "";
        //     for (let data of dataList) {
        //         insertDataRow(data);
        //     }
        // }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>

</body>

</html>